<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- 引入Pannellum全景图依赖 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css">
    <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
        /* 藏式唐卡边框容器 */
        .panorama-container {
            position: relative;
            width: 100%;
            height: 800px;
            margin: 0 auto;
            border: 20px solid transparent;
            border-image: url("https://img.freepik.com/free-photo/tibetan-textile-pattern_23-2149002079.jpg?w=826&t=st=1736445000~exp=1736445600~hmac=8f8c7a8b9d7e6c5b4a3s2d1f0g9h8j7k6l5m4n3b2v1c0x9s8a7d6f5g4h3j2k1l0") 30 stretch;
            box-shadow: 0 0 30px rgba(210, 180, 140, 0.8);
        }

        /* 全景图容器样式（唯一容器，不重复） */
        #panorama {
            width: 100%;
            height: 800px;
            margin: 0 auto;
            position: relative;
        }

        /* 飘雪特效 */
        .snow {
            position: absolute;
            width: 10px; height: 10px;
            background: #fff; border-radius: 50%;
            opacity: 0.7;
            animation: snow-fall 5s linear infinite;
            z-index: 1000;
        }
        @keyframes snow-fall {
            0% { transform: translateY(0); opacity: 0.7; }
            100% { transform: translateY(800px); opacity: 0; }
        }

        /* 藏式烟花CSS */
        .firework {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
        }
        .firework-part {
            position: absolute;
            width: 8px;
            height: 30px;
            background: linear-gradient(to top, #ff3333, #ff9933);
            border-radius: 50%;
            opacity: 1;
            animation: firework-burst 2s ease-out forwards;
        }
        @keyframes firework-burst {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.9; }
            100% { transform: translateY(-100px) rotate(720deg); opacity: 0; }
        }

        /* 播放按钮样式 */
        .play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff3333;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
        }

        /* 粒子特效CSS */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 1;
            animation: particle-fall 3s ease-out forwards;
            width: 80px !important;
            height: 80px !important;
        }
        @keyframes particle-fall {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0.8; }
            100% { transform: translate(0, 100px) rotate(360deg); opacity: 0; }
        }

        /* 场景切换按钮容器 */
        .scene-btn-box {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        /* 场景切换按钮样式 */
        .scene-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        /* 视频弹窗样式（原有视频） */
        #videoModal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 1001;
        }

        /* 视频样式（原有视频） */
        #videoModal video {
            width: 500px;
            height: 300px;
            outline: none;
            border: 3px solid #fff;
            border-radius: 8px;
        }

        /* 关闭视频按钮（原有视频） */
        .close-video-btn {
            margin-top: 10px;
            padding: 8px 16px;
            cursor: pointer;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
        }

        /* 止热寺视频按钮容器 */
        .zr-btn-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }

        /* 止热寺视频弹窗样式 */
        #zrVideoBox {
            display: none;
            position: absolute;
            top: 80px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            z-index: 200;
        }
    </style>
</head>
<body>
    <!-- 藏式唐卡边框容器（唯一外层容器） -->
    <div class="panorama-container">
        <!-- 全景图容器（唯一，不重复） -->
        <div id="panorama"></div>

        <!-- 转山节点+止热寺按钮容器 -->
        <div class="zr-btn-container">
            <button class="scene-btn" style="background: #ff3333; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;"
            onclick="changeScene('test.jpg', 'https://kailashrek.online/wp-content/uploads/2026/01/KAILASH.mp4')">转山起点</button>
            
            <button class="scene-btn" style="background: #229fff; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;"
            onclick="changeScene('pass.jpg', 'https://kailashrek.online/wp-content/uploads/2026/01/PASS.mp4')">第一垭口</button>
            
            <!-- 止热寺视频按钮 -->
            <button id="zrVideoBtn" style="background: #ff9800; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
                卓玛讲解止热寺
            </button>
        </div>

        <!-- 止热寺视频弹窗 -->
        <div id="zrVideoBox">
            <video width="500" controls muted>
                <source src="https://qqmade-qq.github.io/zm.mp4" type="video/mp4">
                你的浏览器不支持视频播放
            </video>
        </div>

        <!-- 原有播放视频按钮 -->
        <button class="play-btn" onclick="showVideo()">点击播放卓玛讲解视频</button>

        <!-- 原有场景切换按钮 -->
        <div class="scene-btn-box">
            <button class="scene-btn" style="background: #ff3333;" onclick='changeScene("test.jpg", "https://kailashtrek.online/wp-content/uploads/2026/01/KAILASH.mp4")'>转山起点</button>
            <button class="scene-btn" style="background: #2299ff;" onclick='changeScene("pass.jpg", "https://kailashtrek.online/wp-content/uploads/2026/01/PASS.mp4")'>第一垭口</button>
        </div>

        <!-- 原有视频弹窗 -->
        <div id="videoModal">
            <video controls autoplay>
                <source src="https://kailashtrek.online/wp-content/uploads/2026/01/KAILASH.mp4" type="video/mp4">
                你的浏览器不支持视频播放
            </video>
            <button class="close-video-btn" onclick="hideVideo()">关闭视频</button>
        </div>
    </div>

    <script>
        // 页面加载完成后初始化
        window.onload = function() {
            // 1. 默认显示转山起点全景+视频
            changeScene(
                'test.jpg',
                'https://kailashrek.online/wp-content/uploads/2026/01/KAILASH.mp4'
            );

            // 2. 止热寺视频弹窗控制
            const zrVideoBtn = document.getElementById('zrVideoBtn');
            const zrVideoBox = document.getElementById('zrVideoBox');
            const zrVideo = zrVideoBox.querySelector('video');

            zrVideoBtn.addEventListener('click', function() {
                zrVideoBox.style.display = zrVideoBox.style.display === 'block' ? 'none' : 'block';
                if (zrVideoBox.style.display === 'block') {
                    zrVideo.play();
                } else {
                    zrVideo.pause();
                }
            });
        };

        // 3. 全景+视频切换核心函数（含飘雪特效）
        function changeScene(picUrl, videoUrl) {
            // 切换全景图
            pannellum.viewer('panorama', {
                "panorama": picUrl,
                "autoLoad": true,
                "title": picUrl.includes('test.jpg') ? "冈仁波齐转山起点" : "转山第一垭口"
            });

            // 切换视频源
            const videoSource = document.querySelector('#videoModal video source');
            videoSource.src = videoUrl;
            document.querySelector('#videoModal video').load();

            // 垭口飘雪特效
            document.querySelectorAll('.snow').forEach(s => s.remove());
            if (picUrl.includes('pass.jpg')) {
                for (let i=0; i<20; i++) {
                    const snow = document.createElement('div');
                    snow.className = 'snow';
                    snow.style.left = `${Math.random()*100}%`;
                    snow.style.animationDelay = `${Math.random()*5}s`;
                    document.querySelector('.panorama-container').appendChild(snow);
                }
            }

            // 隐藏视频
            hideVideo();
        }

        // 4. 原有视频显示/隐藏
        function showVideo() {
            document.getElementById('videoModal').style.display = 'block';
            document.querySelector('.play-btn').style.display = 'none';
        }
        function hideVideo() {
            document.getElementById('videoModal').style.display = 'none';
            document.querySelector('.play-btn').style.display = 'block';
        }

        // 5. 藏式烟花特效
        document.getElementById('panorama').addEventListener('click', function(e) {
            document.querySelectorAll('.firework').forEach(fw => fw.remove());
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${e.clientX}px`;
            firework.style.top = `${e.clientY}px`;
            document.querySelector('.panorama-container').appendChild(firework);

            for (let i = 0; i < 12; i++) {
                const part = document.createElement('div');
                part.className = 'firework-part';
                part.style.transform = `rotate(${i * 30}deg) translateY(0)`;
                firework.appendChild(part);
            }
            setTimeout(() => firework.remove(), 1500);
        });

        // 6. 粒子特效
        const particleImages = [
            "https://img.freepik.com/free-png/tibetan-prayer-flag_1308-14504.jpg?w=360&t=st=1736446000~exp=1736446600~hmac=9a8b7c6d5e4f3g2h1j0k9l8m7n6b5v4c3x2s1d0f9g8h7j6k5l4m3n2b1v0c9x8s7d6f5g4h3j2k1l0",
            "https://img.freepik.com/free-photo/close-up-of-green-barley-field_1339-6417.jpg?w=360&t=st=1736446100~exp=1736446700~hmac=8b7c6d5e4f3g2h1j0k9l8m7n6b5v4c3x2s1d0f9g8h7j6k5l4m3n2b1v0c9x8s7d6f5g4h3j2k1l0"
        ];
        document.getElementById('panorama').addEventListener('click', function(e) {
            const x = e.clientX;
            const y = e.clientY;
            for (let i = 0; i < 3; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const img = particleImages[Math.floor(Math.random() * particleImages.length)];
                particle.style.backgroundImage = `url(${img})`;
                particle.style.left = `${x + Math.random() * 20 - 10}px`;
                particle.style.top = `${y + Math.random() * 20 - 10}px`;
                document.querySelector('.panorama-container').appendChild(particle);
                setTimeout(() => particle.remove(), 2000);
            }
        });
    </script>
</body>
</html>


